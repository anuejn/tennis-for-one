{"version":3,"sources":["util.ts","audio.ts","input.ts","index.ts"],"names":[],"mappings":"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","file":"code.582c34de.js","sourceRoot":"../code","sourcesContent":["export function sleep(seconds: number): Promise<void> {\n    return new Promise((resolve, reject) => {\n        setTimeout(() => resolve(), seconds * 1000)\n    })\n}\n\nexport function registerDeviceMotionEvent(listener: (e: DeviceMotionEvent) => void) {\n    if (typeof (DeviceMotionEvent) !== \"undefined\" && typeof ((DeviceMotionEvent as any).requestPermission) === \"function\") {\n        (DeviceMotionEvent as any).requestPermission()\n            .then(response => {\n                if (response == \"granted\") {\n                    window.addEventListener(\"devicemotion\", listener)\n                }\n            })\n            .catch(console.error)\n    } else if (typeof (DeviceMotionEvent) !== \"undefined\") {\n        window.addEventListener(\"devicemotion\", listener)\n    } else {\n        console.warn(\"DeviceMotionEvent is not defined\");\n    }\n}\n\nexport function pickRandom<T>(list: T[]): T {\n    return list[Math.round(Math.random() * (list.length - 1))]\n}\n\n\nexport function isIos(): boolean {\n    return [\n        'iPad Simulator',\n        'iPhone Simulator',\n        'iPod Simulator',\n        'iPad',\n        'iPhone',\n        'iPod'\n    ].includes(navigator.platform)\n}\n\nexport function clamp(min: number, max: number, val: number): number {\n    console.log(\"clamp imput\", val)\n    return Math.max(min, Math.min(max, val))\n}\n\nexport function interpolate(input: number, options: { input_min: number, input_max: number, output_min: number, output_max: number }): number {\n    return clamp(\n        options.output_min,\n        options.output_max,\n        ((input - options.input_min) / (options.input_max - options.input_min))\n        * (options.output_max - options.output_min) + options.output_min\n    )\n}\n","export const audioCtx = new AudioContext();\n\nexport class PreloadedSoundPlayer {\n    panner: PannerNode;\n    source: AudioBufferSourceNode;\n    ctx: AudioContext;\n    buffer: AudioBuffer;\n    gain: GainNode;\n\n\n    constructor(buffer: AudioBuffer) {\n        this.buffer = buffer;\n\n        this.panner = null;\n        this.source = null;\n        this.gain = null;\n\n        this.preload()\n    }\n\n    preload() {\n        this.panner = new PannerNode(audioCtx, {\n            panningModel: 'HRTF',\n        });\n        this.panner.connect(audioCtx.destination);\n        this.gain = audioCtx.createGain();\n        this.gain.connect(this.panner)\n        this.source = audioCtx.createBufferSource();\n        this.source.buffer = this.buffer;\n        this.source.connect(this.gain);\n    }\n\n    start(options: { gain?: number, x?: number, y?: number, z?: number, loop?: boolean, start?: number, offset?: number, duration?: number } = {}): Promise<void> {\n        const current_time = audioCtx.currentTime;\n        const start = options.start || current_time;\n        const {gain = 1.0, x = 0, y = 0, z = 0, loop = false, offset = 0, duration} = options;\n        this.panner.positionX.value = x;\n        this.panner.positionY.value = y;\n        this.panner.positionZ.value = z;\n        this.gain.gain.value = gain;\n        this.source.loop = loop;\n        this.source.start(start, offset)\n        if (duration) {\n            this.source.stop(start + duration)\n        }\n        return new Promise((resolve) => {\n            setTimeout(() => {\n                this.preload()\n                resolve()\n            }, (start - current_time + (duration || this.buffer.duration) - offset) * 1000)\n        })\n    }\n}","import {audioCtx} from \"./audio\";\nimport {isIos, registerDeviceMotionEvent} from \"./util\";\n\ntype Callback = (is_right: boolean, strength: number) => void;\ntype Unregister = () => void;\n\nlet callbacks: Callback[] = [];\n\nexport function registerCallback(callback: Callback): Unregister {\n    callbacks.push(callback);\n    return () => {\n        callbacks = callbacks.filter(x => x != callback)\n    }\n}\n\nexport function asyncBatHit(): Promise<{is_right: boolean, strength: number, hit: true}> {\n    return new Promise(resolve => {\n        let callback = (is_right, strength) => {\n            callbacks = callbacks.filter(x => x != callback)\n            resolve({is_right, strength, hit: true})\n        };\n        registerCallback(callback)\n    })\n}\nexport function asyncBatHitTimeout(timeout: number): Promise<{is_right: boolean, strength: number, hit: true} | {hit: false}> {\n    return new Promise(resolve => {\n        let callback = (is_right, strength) => {\n            callbacks = callbacks.filter(x => x != callback)\n            resolve({is_right, strength, hit: true})\n        };\n        setTimeout(() => {\n            callbacks = callbacks.filter(x => x != callback)\n            resolve({hit: false});\n        }, timeout * 1000);\n\n        registerCallback(callback)\n    })\n}\n\nexport function initializeMotionSensing(): void {\n    let rate_limit = 1;\n    let last_trigger = audioCtx.currentTime;\n    let triggered = false;\n    let last = 0;\n    let max = 0;\n\n    window.addEventListener(\"keydown\", (e) => {\n        if (e.key == \"ArrowLeft\") {\n            callbacks.forEach(callback => callback(false, 1))\n        } else if (e.key == \"ArrowRight\") {\n            callbacks.forEach(callback => callback(true, 1))\n        }\n    })\n\n    registerDeviceMotionEvent(function (e) {\n        let current_time = audioCtx.currentTime;\n        let val = e.acceleration.x - e.acceleration.z;\n\n\n        if (Math.abs(val) > 20 && (last_trigger + rate_limit < current_time)) {\n            triggered = true;\n            last_trigger = current_time;\n        }\n\n        const grow = Math.sign(last) * last < Math.sign(last) * val;\n        if (triggered && grow) {\n            max = Math.abs(val);\n        }\n        if (triggered && !grow) {\n            document.getElementById(\"log\").innerHTML += `${e.acceleration.z} ${e.acceleration.x} ${val}<br>`;\n            callbacks.forEach(callback => callback(val * (isIos() ? 1 : -1) > 0, 1))\n            triggered = false;\n            max = 0;\n        }\n        last = val;\n    });\n}","import {interpolate, pickRandom, sleep} from \"./util\";\nimport {audioCtx, PreloadedSoundPlayer} from \"./audio\";\nimport {asyncBatHit, asyncBatHitTimeout, initializeMotionSensing, registerCallback} from \"./input\";\n\nimport soundDir from \"../sounds/**/*.mp3\"\n\ninterface Directory extends Record<string, string | Directory> {}\ninterface LoadedDirectory extends Record<string, PreloadedSoundPlayer & LoadedDirectory> {}\n\nasync function loadSounds(dir: Directory): Promise<LoadedDirectory> {\n    return Object.fromEntries(await Promise.all(Object.entries(dir).map(async ([name, dir]) => {\n        if (typeof dir === \"string\") {\n            const data = await fetch(dir).then(x => x.arrayBuffer()).then(x => audioCtx.decodeAudioData(x));\n            return [name, new PreloadedSoundPlayer(data)]\n        } else {\n            return [name, await loadSounds(dir)]\n        }\n    })))\n}\n\nfunction pick(dir: LoadedDirectory | PreloadedSoundPlayer): PreloadedSoundPlayer {\n    if (dir instanceof PreloadedSoundPlayer) {\n        return dir\n    }\n    let values = Object.values(dir).filter(x => x instanceof PreloadedSoundPlayer);\n    return pickRandom(values) as PreloadedSoundPlayer;\n}\n\nasync function onload() {\n    const sounds = await loadSounds(soundDir);\n\n    async function startGame() {\n        document.getElementById(\"start\").style.display = 'none';\n        document.getElementById(\"log\").innerHTML = \"\";\n\n        initializeMotionSensing()\n\n        // create some ambience\n        pick(sounds.noise).start({loop: true, gain: 0.004})\n        async function play_wildlife() {\n            const birds = pick(sounds.birds);\n\n            const offset = Math.random() * birds.buffer.duration;\n            const duration = Math.random() * 5 + 7;\n            const current_time = audioCtx.currentTime;\n            birds.start({\n                start: current_time,\n                offset,\n                duration,\n                x: (Math.random() - 0.5) * 15,\n                y: (Math.random() - 0.5) * 5,\n                z: (Math.random() - 0.5) * 5\n            })\n            birds.gain.gain.value = 0.001;\n            birds.gain.gain.linearRampToValueAtTime(0.6, current_time + (duration / 2))\n            await sleep(duration / 2)\n            birds.gain.gain.linearRampToValueAtTime(0.001, current_time + duration)\n            await sleep(duration / 2)\n\n            setTimeout(play_wildlife, Math.random() * 5000)\n        }\n        play_wildlife()\n\n        // initialize state for the main game loop\n        let last_target = null as null | {\n            target_time: number,\n            ball_right: boolean,\n        };\n        let in_a_row = 0;\n        let player_points = 0;\n        let computer_points = 0;\n        let remind_to_play = true;\n\n        let narrator_pos = {z: 7, x: -1, y: 0};\n        let story = Object.entries(sounds.dev.story).sort((a, b) => parseInt(a[0]) - parseInt(b[0])).map(x => x[1]);\n        let story_progress = 0;\n        let narrator_player: PreloadedSoundPlayer = story[0];\n\n        async function failed() {\n            in_a_row = 0;\n            last_target = null;\n\n            await pick(sounds.tennis.bounce_failed).start({gain: 2, z: -5});\n            await sleep(0.2);\n            await pick(sounds.player.negative).start({gain: 0.7});\n            await sleep(0.5);\n            computer_points += 1;\n            document.getElementById(\"game_counter\").innerText = `${player_points}:${computer_points}`\n\n            try {\n                narrator_player.source.stop(0);\n            } catch (e) {\n\n            }\n            if (computer_points > player_points + 5) {\n                narrator_player = sounds.dev.intro_02;\n                narrator_player.start(narrator_pos);\n            } else if (computer_points > player_points + 6) {\n                narrator_player = sounds.dev.intro_03;\n                narrator_player.start(narrator_pos);\n            } else if (computer_points > player_points + 6) {\n                narrator_player = sounds.dev.intro_04;\n                narrator_player.start(narrator_pos);\n            } else if (player_points > 2) {\n                if (Math.random() > 0.6) {\n                    narrator_player = pick(sounds.dev.negative);\n                    narrator_player.start(narrator_pos)\n                }\n            }\n        }\n\n        registerCallback((is_right, strength) => {\n            sounds.tennis.swoosh.start({gain: 1, x: is_right ? 1 : -1, y: 1});\n        })\n\n        narrator_player = sounds.dev.intro_01;\n        narrator_player.start(narrator_pos)\n\n        const tolerance = 0.3;\n        while (true) {\n            let currentTime = audioCtx.currentTime;\n\n            let is_right;\n            let timing = 0;\n            console.log(\"waiting for hit\", last_target)\n            if (last_target) {\n                console.log(\"timing\", last_target.target_time - currentTime);\n                const hit = await asyncBatHitTimeout(last_target.target_time - currentTime + tolerance);\n                if (hit.hit) {\n                    currentTime = audioCtx.currentTime;\n                    timing = currentTime - last_target.target_time\n                    is_right = hit.is_right;\n                    console.log(\"timing\", timing)\n                    if (is_right != last_target.ball_right || timing < -tolerance) {\n                        await failed();\n                        continue;\n                    }\n                    in_a_row += 1;\n                } else {\n                    await failed();\n                    continue;\n                }\n            } else {\n                const hit = await asyncBatHitTimeout(20);\n                if (!hit.hit) {\n                    if (remind_to_play && computer_points + player_points < 4) {\n                        remind_to_play = false;\n                        narrator_player = sounds.dev.wirds_bald;\n                        await narrator_player.start(narrator_pos)\n                    }\n                    continue;\n                }\n                is_right = hit.is_right\n            }\n            console.log(\"hit\", is_right, timing)\n\n            const interpolate_options = {\n                input_min: 0,\n                input_max: 7,\n                output_min: 0,\n            }\n            const air_time = ((0.9 / (1 + (in_a_row / 30))) - Math.random() * interpolate(in_a_row, {output_max: 0.2, ...interpolate_options})) + timing;\n            const bounce_time = 0.5 / (1 + (in_a_row / 30)) - Math.random() * interpolate(in_a_row, {output_max: 0.15, ...interpolate_options});\n            const my_air_time = air_time;\n            const my_bounce_time = bounce_time;\n\n\n            // we hit the ball\n            pick(sounds.tennis.bat).start({x: is_right ? 1 : -1});\n\n            // we move the narrator\n            const other_player_right = Math.random() > (0.5 + (is_right ? 0.1 : -0.1));\n            narrator_pos = {x: other_player_right ? 10 : -10, z: 10, y: 5}\n            const end_time = audioCtx.currentTime + air_time + bounce_time;\n            narrator_player.panner.positionX.linearRampToValueAtTime(narrator_pos.x, end_time)\n            narrator_player.panner.positionY.linearRampToValueAtTime(narrator_pos.y, end_time)\n            narrator_player.panner.positionZ.linearRampToValueAtTime(narrator_pos.z, end_time)\n            narrator_player.gain.gain.exponentialRampToValueAtTime(2, end_time - 0.1)\n\n            await sleep(air_time);\n\n            const threshold = interpolate(player_points - computer_points, {\n                input_min: 0,\n                input_max: 12,\n                output_min: 0,\n                output_max: 0.2\n            })\n            const other_player_miss = (Math.random() + (timing / 2) <.5 - threshold) && in_a_row > 2;\n            if (other_player_miss) {\n                // the other players bounce\n                console.log(\"bounce_other\")\n                pick(sounds.tennis.ground_bounce).start({x: (is_right ? 3 : -3), z: 7, y: -2})\n                await sleep(bounce_time + 0.2);\n                console.log(\"other_missed\")\n                pick(sounds.tennis.bounce_failed).start({x: is_right ? 7 : -7, z: 10, y: 5, gain: 3});\n                last_target = null;\n                player_points += 1;\n                in_a_row = 0;\n                document.getElementById(\"game_counter\").innerText = `${player_points}:${computer_points}`\n                await sleep(1)\n                pick(sounds.player.positive).start({gain: 0.8})\n                if (player_points > 2) {\n                    await sleep(0.5)\n                    narrator_player = story[story_progress];\n                    story_progress += 1;\n                    narrator_player.start({gain: 1.5, ...narrator_pos})\n                }\n                continue\n            }\n\n            currentTime = audioCtx.currentTime;\n            let duration = bounce_time + my_air_time + my_bounce_time;\n            const target_time = currentTime + duration;\n            last_target = {\n                target_time,\n                ball_right: other_player_right,\n            }\n\n            // the other players bounce\n            console.log(\"bounce_other\")\n            pick(sounds.tennis.ground_bounce).start({gain: 1.2, x: (is_right && other_player_right ? 2 : -2) + (other_player_right ? 1 : -1), z: 7, y: -2})\n            await sleep(bounce_time);\n            // the other players bat\n            console.log(\"bat_other\")\n            if (Math.random() > .7) {\n                pick(sounds.dev.huh).start(narrator_pos)\n            }\n            pick(sounds.tennis.bat).start({gain: 1.2, ...narrator_pos})\n            narrator_player.gain.gain.exponentialRampToValueAtTime(1.5, end_time + 0.1)\n\n            // the ball bounces on our side\n            await sleep(my_air_time)\n            console.log(\"bounce_me\")\n            pick(sounds.tennis.ground_bounce).start({gain: 1.2, x: other_player_right ? 1.5 : -1.5, z: 1.5, y: -2})\n        }\n    }\n\n    const start = document.getElementById(\"start\");\n    start.addEventListener(\"mousedown\", startGame);\n    start.innerText = \"START GAME\"\n\n    if (/Android/i.test(navigator.userAgent)) {\n        alert(\"sorry, android phones might not work really well :(\")\n    }\n}\n\nonload();\n"]}